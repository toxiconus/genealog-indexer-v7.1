<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Wyczy≈õƒá Supabase (Fetch API)</title>
    <style>
        body { 
            font-family: monospace; 
            padding: 30px; 
            background: #1a1a1a; 
            color: #0f0;
            max-width: 800px;
            margin: 0 auto;
        }
        h1 { color: #f00; margin-bottom: 20px; }
        .status { 
            margin: 15px 0; 
            padding: 10px; 
            border-left: 4px solid #0f0; 
            background: #0a0a0a;
        }
        .error { border-left-color: #f00; color: #f00; }
        .warning { border-left-color: #ff0; color: #ff0; }
        button { 
            padding: 15px 30px; 
            background: #f00; 
            color: white; 
            border: none; 
            cursor: pointer; 
            margin: 20px 0;
            font-size: 16px;
            border-radius: 5px;
        }
        button:hover { background: #c00; }
        #output { margin-top: 30px; }
    </style>
</head>
<body>
    <h1>üßπ WYCZY≈öƒÜ SUPABASE (FETCH API)</h1>
    <p>‚ö†Ô∏è OSTRZE≈ªENIE: To usunie WSZYSTKIE rekordy z public_imports!</p>
    <button onclick="truncateTableFetch()">üóëÔ∏è WYCZY≈öƒÜ TABELƒò</button>
    <div id="output"></div>

    <script>
        function log(msg, type = 'info') {
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
            document.getElementById('output').appendChild(div);
            console.log(msg);
            
            // Scroll to bottom
            div.scrollIntoView({ behavior: 'smooth' });
        }

        const SUPABASE_URL = 'https://jbwkrconzozhgzikabmv.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_X0Qm9TSqq0nOOtCo8RycMQ_PeirqbMt';

        async function truncateTableFetch() {
            if (!confirm('‚ö†Ô∏è NA PEWNO? To usunie WSZYSTKIE 22260 rekord√≥w! Tego nie mo≈ºna cofnƒÖƒá!')) {
                log('‚ùå Anulowano', 'error');
                return;
            }

            log('‚è≥ Usuwam wszystkie rekordy z tabeli public_imports...', 'warning');
            
            try {
                // U≈ºywaj REST API Supabase bezpo≈õrednio
                // Filtr: id.gte.0 matchuje wszystkie rekordy z ID >= 0
                log('‚è≥ Wysy≈Çam DELETE request...', 'warning');
                const url = `${SUPABASE_URL}/rest/v1/public_imports?id=gte.0`;
                log(`URL: ${url}`, 'info');
                
                const response = await fetch(url, {
                    method: 'DELETE',
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`,
                        'Content-Type': 'application/json'
                    }
                });

                log(`Status: ${response.status} ${response.statusText}`, 'info');

                if (!response.ok) {
                    const error = await response.text();
                    log(`‚ùå B≈ÇƒÖd HTTP ${response.status}:`, 'error');
                    log(error, 'error');
                    return;
                }

                log('‚úÖ WSZYSTKIE REKORDY USUNIƒòTE!', 'warning');
                log('üìä Tabela jest teraz pusta', 'warning');
                log('', 'info');
                log('üîÑ NASTƒòPNE KROKI:', 'warning');
                log('1. Otw√≥rz import-ch-blin.html', 'info');
                log('2. Za≈Çaduj plik CH BLIN.txt', 'info');
                log('3. Mapuj kolumny prawid≈Çowo', 'info');
                log('4. Kliknij EKSPORTUJ DO SUPABASE', 'info');
                log('5. Czekaj a≈º pasek postƒôpu dojdzie do 100%', 'info');
                log('6. Od≈õwie≈º viewer-osd-v8.11.html', 'info');

            } catch (error) {
                log(`‚ùå WyjƒÖtek: ${error.message}`, 'error');
                log(`Stack: ${error.stack}`, 'error');
            }
        }

        // Expose to window for button
        window.truncateTableFetch = truncateTableFetch;
        
        log('‚úÖ Skrypt za≈Çadowany - kliknij przycisk aby wyczy≈õciƒá tabelƒô', 'warning');
    </script>
</body>
</html>
