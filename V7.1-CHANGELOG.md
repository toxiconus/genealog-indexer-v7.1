# ğŸš€ Genealog Indexer v7.1 - Changelog

**Wersja:** 7.1 (v7.0 + Features A, B, C, D, E)  
**Data:** 20 grudnia 2025  
**Status:** âœ… Wszystkie 5 funkcji A-E zaimplementowane

---

## ğŸ“‹ Cechy V7.1 (All 5 Features Implemented)

### ğŸ’¡ Feature A: Suggestions Fan - Wachlarz Podpowiedzi

**Co to robi:**
- Gdy piszesz w polu, pokazuje siÄ™ wachlarz z poprzednimi wartoÅ›ciami tego samego pola z innych aktÃ³w na tej stronie
- Automatycznie filtruje sugestie na podstawie tego co wÅ‚aÅ›nie piszesz
- Klik na sugestiÄ™ - od razu wstawia wartoÅ›Ä‡ do pola

**Implementacja:**
- Nowa funkcja: `showSuggestionsForField(inputEl)`
- HTML container: `#suggestionsWachlarz` (position: absolute, z-index: 200)
- CSS animacja: `@keyframes fanRotate` (rotate -3Â° + scale)
- Event: Input listener w formularzu wyzwala `showSuggestionsForField()`

**Keyboard:** 
- Escape lub Click poza wachlarzem - zamyka
- Enter - wybiera numer jeden (jeÅ›li doda siÄ™ to spÃ¤ter)

**Kolory:**
- Niebieski (#0078d4) - standarowy
- Neon-zielony (#00ff88) - hover

---

### âŒ¨ï¸ Feature B: Keyboard Shortcuts - SkrÃ³ty Klawiszowe

**Zaimplementowane skrÃ³ty:**

| SkrÃ³t | Akcja | Opis |
|-------|-------|------|
| **Ctrl+S** | Zapisz | `saveRecord()` - zapisz bieÅ¼Ä…cy akt |
| **Ctrl+D** | UsuÅ„ | `deleteCurrentRecord()` - usuÅ„ z potwierdzeniem |
| **Ctrl+C** | Duplikuj | `copyPreviousActEnhanced()` - kopiuj z poprzedniego |
| **Ctrl+N** | Nowy | Dodaj 1 lub wiÄ™cej aktÃ³w (prompt: ile?) |
| **â† â†’** | Nawiguj | StrzaÅ‚ki lewy/prawy - przejdÅº miÄ™dzy aktami |

**Implementacja:**
- Funkcja: `setupKeyboardShortcuts()`
- Wyzwolona na startup (bottom skriptu)
- Ctrl/Cmd detection dla cross-platform
- Ignoruje w textarea (oprÃ³cz Ctrl/Cmd)

**Feedback:**
- `console.log()` dla kaÅ¼dego skrÃ³tu (console: `âŒ¨ï¸ B: Ctrl+X â†’ Akcja`)
- `notify()` dla dodania aktÃ³w

---

### ğŸ“Š Feature C: Act Statistics - Statystyki Aktu

**Co pokazuje:**
- Licznik wypeÅ‚nionych pÃ³l: `N/M` (np. `3/5` znaczy 3 z 5 pÃ³l wypeÅ‚nione)
- Licznik zaznaczonych ROI: `M` (np. `ğŸ¨ 2 ROI`)
- Pasek postÄ™pu z kolorem: niebieski (niedokoÅ„czony) â†’ zielony (100%)

**Implementacja:**
- Funkcja: `updateProgressBar()` - oblicza procent
- Funkcja: `updateActStatistics()` - formatuje statystyki  
- Wyzwalane: Na kaÅ¼dy `input` event w formularzu

**HTML:**
```html
<div id="progressBar" style="...">
    <div id="progressFill"></div>
    <span id="progressText">0/5</span>
</div>
```

**Display:**
- Pasek: Na gÃ³rze formularza (juÅ¼ istnieje w v7.0)
- Statystyki: `console.log()` (jeÅ›li bÄ™dzie potrzeba, mogÄ… byÄ‡ w toolbar'u)

---

### ğŸ“‹ Feature D: Copy Previous Enhanced - Duplikuj Ulepszone

**Co to robi:**
- Kopiuje wartoÅ›ci WSZYSTKICH pÃ³l z poprzedniego aktu
- Kopiuje rÃ³wnieÅ¼ ROI'e (zaznaczenia obszarÃ³w) jeÅ›li istniejÄ…
- Przeskakuje do pierwszego pola (fokus automatyczny - Feature E)

**Implementacja:**
- Stara funkcja: `copyPreviousRecord()` â†’ Zmieniona na `copyPreviousActEnhanced()`
- Przyciski: Zmieniona ikona i etykieta na "Duplikuj (C)"
- Event: `onclick="copyPreviousActEnhanced()"`

**Klawisz:**
- Ctrl+C (w formularzu)

**Feedback:**
- Notification: `âœ¨ Skopiowano z Aktu N`
- Console: `ğŸ“‹ D: Copy Previous`

**Walidacja:**
- JeÅ›li to pierwszy akt â†’ bÅ‚Ä…d: `â„¹ï¸ Brak poprzedniego aktu`

---

### E: Auto-Focus First Field - Fokus Na Pierwsze Pole

**Co to robi:**
- Gdy wybierasz akt (klikiem na przycisk) â†’ automatycznie fokus przeskakuje na pierwsze puste pole w formularzu
- OszczÄ™dza klikniÄ™cie, przyspiesza workflow

**Implementacja:**
- Nowa funkcja: `focusFirstField()`
- WywoÅ‚ywana: Na koniec `selectAct(actNum)`
- Delay: 100ms (czeka aÅ¼ forma siÄ™ zaÅ‚aduje)

**Bonus:**
- JeÅ›li pole jest zaznaczone (has-roi) - teÅ¼ siÄ™ fokusuje, ale inne najpierw

---

## ğŸ”§ Zmiany Techniczne

### Nowe Funkcje (8)
1. `showSuggestionsForField(inputEl)` - A: Wachlarz
2. `hideSuggestions()` - A: Ukrywa wachlarz
3. `updateProgressBar()` - C: Pasek postÄ™pu
4. `updateActStatistics()` - C: Statystyki
5. `focusFirstField()` - E: Auto-focus
6. `setupKeyboardShortcuts()` - B: SkrÃ³ty
7. `copyPreviousActEnhanced()` - D: Duplikuj ulepszone
8. (BezpoÅ›rednio zmodyfikowana) `selectAct()` - dodano `focusFirstField()` na koniec

### Zmienione Funkcje (2)
- `selectAct()` - Dodano: `focusFirstField()` na koniec
- `updateFieldStatus()` - JuÅ¼ nie ma siÄ™ ze zmian (uÅ¼ywa tej samej), ale `updateProgressBar()` jest teraz osobnie

### Nowe HTML Elementy
- `#suggestionsWachlarz` - Container dla wachlarza (juÅ¼ byÅ‚ w v7.0)

### Nowe CSS
- `@keyframes fanRotate` - Animacja dla sugestii

### Zmienione Przyciski
- "Kopiuj poprzedni" â†’ "Duplikuj (C)" - Hint klawisza

### Event Listeners
- Input listener - Dodano: `showSuggestionsForField()`
- Keydown listener - Dodano: CaÅ‚Ä… funkcjÄ™ `setupKeyboardShortcuts()`
- Click listener - Dodano: Hide sugestii na click poza wachlarzem

---

## ğŸ“Š Statystyka Kodu

- **Linie dodane:** ~280 (funkcje A-E + CSS)
- **ÅÄ…cznie v7.1:** 3895 linii
- **Zmienione pliki:** 1 (`viewer-osd-v7.html`)
- **Backup:** `viewer-osd-v7.html.backup-v7.1-features-A-B-C-D-E-...html`

---

## ğŸ® User Experience (UX)

### Przed V7.1
```
1. Wybierz obraz
2. Kliknij Akt 1
3. Kliknij na pole
4. Wpisz wartoÅ›Ä‡
5. Kliknij Akt 2
6. PowtÃ³rz... (nudzÄ…ce!)
```

### Po V7.1
```
1. Wybierz obraz
2. Kliknij Akt 1 â†’ Automatycznie fokus na polu
3. Wpisz "Jan" â†’ Wachlarz pokazuje "Jan", "Jakub", "JÃ³zef"
4. Kliknij "Jan" lub Ctrl+â†“
5. Ctrl+C â†’ Kopiuje wszystko z Aktu 1
6. Ctrl+S â†’ Zapisuje
7. Ctrl+N â†’ Dodaj 3 akty
8. Ctrl+â†’ â†’ PrzejdÅº do Aktu 2 â†’ Auto-focus âœ…
```

---

## âœ… Testing Checklist

- [ ] Wachlarz pojawia siÄ™ przy wpisywaniu (A)
- [ ] Sugestie filtrujÄ… siÄ™ poprawnie (A)
- [ ] Klik na sugestiÄ™ wstawia wartoÅ›Ä‡ (A)
- [ ] Ctrl+S zapisuje (B)
- [ ] Ctrl+D usuwa z potwierdzeniem (B)
- [ ] Ctrl+C kopuje poprzedni (B+D)
- [ ] Ctrl+N otwiera prompt, dodaje akty (B)
- [ ] StrzaÅ‚ki nawigujÄ… miÄ™dzy aktami (B)
- [ ] Pasek postÄ™pu pokazuje N/M (C)
- [ ] Fokus przeskakuje na pierwsze pole (E)
- [ ] Wachlarz nie przeszkadza w edycji (A)
- [ ] ROI'e siÄ™ kopiÄ… razem z wartoÅ›ciami (D)

---

## ğŸš¨ Known Issues & Workarounds

1. **Wachlarz poza ekranem** - JeÅ›li pole jest na brzegu ekranu, wachlarz moÅ¼e wychodziÄ‡ poza viewport
   - Workaround: PrzesuÅ„ formularz bardziej do Å›rodka
   - Fix v7.2: ZmieÅ„ pozycjonowanie wachlarza w zaleÅ¼noÅ›ci od pozycji pola

2. **Ctrl+C w textarea** - Ctrl+C w textarea to standardowy copy (nie duplikuj akt)
   - By design: TextArea' ma priorytet
   - Workaround: WyjdÅº z textarea, uÅ¼yj Ctrl+C na formularzu lub kliknij przycisk

3. **Wiele aktÃ³w naraz** - Ctrl+N z bardzo duÅ¼Ä… liczbÄ… moze byÄ‡ wolne
   - By design: KaÅ¼dy akt to osobny obiekt w pamiÄ™ci
   - Workaround: Dodaj kilka aktÃ³w (5-10 za razem), potem wiÄ™cej

---

## ğŸ” Backward Compatibility

- âœ… Wszystkie dane z v7.0 dziaÅ‚ajÄ… w v7.1
- âœ… localStorage format nie zmieniÅ‚ siÄ™
- âœ… Wszystkie v7.0 features (ROI, Acts, OCR, Post-processing) dziaÅ‚ajÄ… dalej
- âœ… MoÅ¼na wrÃ³ciÄ‡ do v7.0 - wystarczy zaÅ‚adowaÄ‡ backup

---

## ğŸ¯ NastÄ™pne Kroki (V7.2+)

1. **Emoji Icons** - Dodaj ikonki do przyciskÃ³w (Floppy, Trash, Copy, Plus, etc.)
2. **Undo/Redo** - Przechowuj historiÄ™ zmian (3-5 ostatnich stanÃ³w)
3. **Wachlarz Position Fix** - Inteligentne pozycjonowanie wachlarza
4. **Search/Filter** - Szukaj aktÃ³w po wartoÅ›ciach pÃ³l (Ctrl+F)
5. **CSV Import** - Importuj dane z CSV do aktÃ³w
6. **Batch ROI** - Zaznacz ROI na jednym akcie, skopiuj do 5 nastÄ™pnych

---

## ğŸ“ Notatki Deweloperskie

### Event Flow - Feature A (Suggestions)
```
input event (user types)
    â†’ showSuggestionsForField(inputEl)
        â†’ getPreviousValues(fieldId)
        â†’ filterBySimilarity(currentValue)
        â†’ positionWachlarz(inputEl)
        â†’ renderSuggestions()
            â†’ divs with onclick handlers
```

### Event Flow - Feature B (Shortcuts)
```
keydown event
    â†’ Check Ctrl/Cmd
    â†’ Check key (s/d/c/n/arrow)
    â†’ Execute corresponding function
    â†’ console.log('âŒ¨ï¸ B: ...')
    â†’ notify() if needed
```

### Event Flow - Feature E (Focus)
```
selectAct(actNum)
    â†’ clearPinups()
    â†’ loadActToForm()
    â†’ renderActButtons()
    â†’ redrawROIs()
    â†’ focusFirstField()  â† NEW
        â†’ find .field-input
        â†’ .focus() + .select()
```

---

## ğŸ”— PowiÄ…zane Pliki

- **Main:** `public/viewer-osd-v7.html` (3895 linii)
- **Backup:** `public/viewer-osd-v7.0.final.html` (3543 linii - przed v7.1)
- **Dokumentacja:** `PRZEWODNIK.md`, `README.md` (zawiera ogÃ³Å‚em architekturÄ™)

---

## ğŸ“ Support

JeÅ›li coÅ› nie dziaÅ‚a:
1. OtwÃ³rz DevTools (F12)
2. SprawdÅº Console (kolor emoji logu powinien pokazaÄ‡ gdzie bÅ‚Ä…d)
3. SprawdÅº localStorage: `JSON.parse(localStorage.getItem('genealog_data'))`
4. PrzywrÃ³Ä‡ backup: `viewer-osd-v7.0.final.html`

---

**Autor:** GitHub Copilot  
**Tester:** TBD  
**Status:** âœ… Ready for QA
